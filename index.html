<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistema de Rutas Colaborativo</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 0;
    }
    header {
      background: #001f3f;
      color: white;
      text-align: center;
      padding: 20px;
      font-size: 1.5em;
    }
    .week-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
      padding: 20px;
    }
    .day-card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      padding: 15px;
      display: flex;
      flex-direction: column;
    }
    .day-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      color: #001f3f;
      border-bottom: 1px solid #eee;
      padding-bottom: 5px;
    }
    .routes-container {
      margin-top: 10px;
      max-height: 250px;
      overflow-y: auto;
    }
    .route-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f8f9fc;
      border-radius: 8px;
      padding: 8px;
      margin-bottom: 8px;
    }
    .route-field {
      flex: 1;
      padding: 0 6px;
      font-size: 0.9em;
    }
    .route-field.route { font-weight: 600; }
    .delete-btn {
      background: transparent;
      border: none;
      color: #c00;
      cursor: pointer;
      font-size: 1.2em;
    }
    .empty-state {
      text-align: center;
      color: #aaa;
      margin-top: 20px;
    }
    .toast-custom {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #001f3f;
      color: white;
      padding: 10px 18px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      animation: fadeInOut 3s ease forwards;
      z-index: 9999;
    }
    @keyframes fadeInOut {
      0% { opacity: 0; transform: translate(-50%, 20px); }
      10%, 90% { opacity: 1; transform: translate(-50%, 0); }
      100% { opacity: 0; transform: translate(-50%, -10px); }
    }
    .add-btn {
      background: #001f3f;
      color: white;
      border: none;
      border-radius: 50%;
      width: 55px;
      height: 55px;
      font-size: 1.5em;
      position: fixed;
      bottom: 25px;
      right: 25px;
      box-shadow: 0 5px 12px rgba(0,0,0,0.3);
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    üöå Sistema de Rutas Colaborativo
  </header>

  <main class="week-container">
    <div class="day-card" id="LUNES">
      <div class="day-header">Lunes <span id="count-LUNES">0</span></div>
      <div class="routes-container" id="routes-LUNES"></div>
    </div>
    <div class="day-card" id="MARTES">
      <div class="day-header">Martes <span id="count-MARTES">0</span></div>
      <div class="routes-container" id="routes-MARTES"></div>
    </div>
    <div class="day-card" id="MI√âRCOLES">
      <div class="day-header">Mi√©rcoles <span id="count-MI√âRCOLES">0</span></div>
      <div class="routes-container" id="routes-MI√âRCOLES"></div>
    </div>
    <div class="day-card" id="JUEVES">
      <div class="day-header">Jueves <span id="count-JUEVES">0</span></div>
      <div class="routes-container" id="routes-JUEVES"></div>
    </div>
    <div class="day-card" id="VIERNES">
      <div class="day-header">Viernes <span id="count-VIERNES">0</span></div>
      <div class="routes-container" id="routes-VIERNES"></div>
    </div>
    <div class="day-card" id="S√ÅBADO">
      <div class="day-header">S√°bado <span id="count-S√ÅBADO">0</span></div>
      <div class="routes-container" id="routes-S√ÅBADO"></div>
    </div>
    <div class="day-card" id="DOMINGO">
      <div class="day-header">Domingo <span id="count-DOMINGO">0</span></div>
      <div class="routes-container" id="routes-DOMINGO"></div>
    </div>
  </main>

  <!-- SDKs de Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <!-- ======================================= -->
  <!-- üî• FIREBASE - CONEXI√ìN Y GUARDADO EN appData/routes/data -->
  <!-- ======================================= -->
  <script>
    // 1Ô∏è‚É£ Configuraci√≥n de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyABEOcduBpaKCTWSj0UJbiQ09PRJPsTXHw",
      authDomain: "sistema-rutas-colaborativo.firebaseapp.com",
      projectId: "sistema-rutas-colaborativo",
      storageBucket: "sistema-rutas-colaborativo.firebasestorage.app",
      messagingSenderId: "653094221545",
      appId: "1:653094221545:web:ca296982c20df52f916278"
    };

    // 2Ô∏è‚É£ Inicializar Firebase y Firestore
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const routesRef = db.collection("appData").doc("routes").collection("data");

    // 3Ô∏è‚É£ Guardar una nueva ruta
    async function guardarRuta(dia, chofer, unidad, ruta) {
      try {
        await routesRef.add({
          dia,
          chofer,
          unidad,
          ruta,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        mostrarToast("‚úÖ Ruta guardada con √©xito");
      } catch (error) {
        console.error("‚ùå Error al guardar:", error);
        mostrarToast("‚ùå Error al guardar la ruta");
      }
    }

    // 4Ô∏è‚É£ Escuchar rutas en tiempo real
    function escucharRutas() {
      routesRef.orderBy("timestamp", "asc").onSnapshot(snapshot => {
        const rutas = [];
        snapshot.forEach(doc => rutas.push({ id: doc.id, ...doc.data() }));
        actualizarVista(rutas);
      });
    }

    // 5Ô∏è‚É£ Mostrar rutas en el tablero semanal
    function actualizarVista(rutas) {
      const dias = ["LUNES", "MARTES", "MI√âRCOLES", "JUEVES", "VIERNES", "S√ÅBADO", "DOMINGO"];
      dias.forEach(dia => {
        const contenedor = document.getElementById(`routes-${dia}`);
        const contador = document.getElementById(`count-${dia}`);
        if (!contenedor) return;

        const rutasDia = rutas.filter(r => r.dia === dia);
        contador.textContent = rutasDia.length;

        if (rutasDia.length === 0) {
          contenedor.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-route"></i>
              <p>No hay rutas programadas</p>
            </div>`;
        } else {
          contenedor.innerHTML = rutasDia.map(r => `
            <div class="route-row">
              <div class="route-field route">${r.ruta}</div>
              <div class="route-field driver">${r.chofer}</div>
              <div class="route-field truck">${r.unidad}</div>
              <button class="delete-btn" onclick="eliminarRuta('${r.id}')">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          `).join("");
        }
      });
    }

    // 6Ô∏è‚É£ Eliminar una ruta
    async function eliminarRuta(id) {
      try {
        await routesRef.doc(id).delete();
        mostrarToast("üóëÔ∏è Ruta eliminada");
      } catch (error) {
        console.error("Error al eliminar:", error);
        mostrarToast("‚ùå Error al eliminar la ruta");
      }
    }

    // 7Ô∏è‚É£ Agregar ruta manual (bot√≥n flotante)
    function agregarRutaDemo() {
      const dia = prompt("D√≠a (LUNES, MARTES...):");
      const chofer = prompt("Chofer:");
      const unidad = prompt("Unidad:");
      const ruta = prompt("Ruta:");
      if (dia && chofer && unidad && ruta) {
        guardarRuta(dia.toUpperCase(), chofer, unidad, ruta);
      }
    }

    // 8Ô∏è‚É£ Toast de notificaci√≥n
    function mostrarToast(mensaje) {
      const toast = document.createElement("div");
      toast.className = "toast-custom";
      toast.innerHTML = `<i class="fas fa-info-circle"></i> <span>${mensaje}</span>`;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    // 9Ô∏è‚É£ Iniciar escucha en tiempo real
    window.onload = () => escucharRutas();
  </script>

  <!-- Bot√≥n flotante de prueba -->
  <button class="add-btn" onclick="agregarRutaDemo()">+</button>

</body>
</html>
